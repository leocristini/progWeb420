CREATE TABLE USERS (

ID INTEGER NOT NULL,

FIRSTNAME VARCHAR(255) NOT NULL,

LASTNAME VARCHAR(255) NOT NULL,

USER_TYPE VARCHAR(5) DEFAULT 'A',

USERNAME VARCHAR(255) NOT NULL,

PASSWORD VARCHAR(255) NOT NULL,

PRIMARY KEY (ID),

UNIQUE (USERNAME)

);


CREATE TABLE RESTAURANTS (

ID INTEGER NOT NULL ,

NAME VARCHAR(255) NOT NULL,

ADDRESS VARCHAR(255) NOT NULL,

CIVIC INT NOT NULL,

CITY VARCHAR(255) NOT NULL,

DESCRIPTION VARCHAR(32000),

WEB_SITE_URL VARCHAR(255),

GLOBAL_VALUE INTEGER CONSTRAINT GLOBAL_VALUE_CHECK CHECK (GLOBAL_VALUE

>= 0 AND

GLOBAL_VALUE <= 5),

PRICE_RANGE INTEGER NOT NULL,

ID_OWNER INTEGER ,

ID_CREATOR INTEGER NOT NULL,

PRIMARY KEY (ID),

FOREIGN KEY (ID_OWNER) REFERENCES USERS (ID),

FOREIGN KEY (ID_CREATOR) REFERENCES USERS (ID)

);

CREATE TABLE PHOTOS (

ID INTEGER NOT NULL ,

PATH VARCHAR(255) NOT NULL,

ID_RESTAURANT INTEGER NOT NULL,

ID_CREATOR INTEGER NOT NULL,

PRIMARY KEY (ID),

FOREIGN KEY (ID_RESTAURANT) REFERENCES RESTAURANTS (ID),

FOREIGN KEY (ID_CREATOR) REFERENCES USERS (ID)

);

CREATE TABLE COORDINATES (

ID INTEGER NOT NULL ,

LATITUDE FLOAT NOT NULL,

LONGITUDE FLOAT NOT NULL,

ADDRESS VARCHAR(255) NOT NULL,

PRIMARY KEY (ID)

);

CREATE TABLE RESTAURANT_COORDINATE (

ID_RESTAURANT INTEGER NOT NULL,

ID_COORDINATE INTEGER NOT NULL,

PRIMARY KEY (ID_RESTAURANT, ID_COORDINATE),

FOREIGN KEY (ID_RESTAURANT) REFERENCES RESTAURANTS (ID),

FOREIGN KEY (ID_COORDINATE) REFERENCES COORDINATES (ID)

);

CREATE TABLE OPENING_HOURS_RESTAURANTS (

ID_RESTAURANT INTEGER NOT NULL ,

DAY_OF_THE_WEEK INTEGER CONSTRAINT DAY_OF_THE_WEEK_CHECK CHECK

(DAY_OF_THE_WEEK >= 1 AND

DAY_OF_THE_WEEK <= 7),

START_HOUR_LUNCH TIME NOT NULL,

END_HOUR_LUNCH TIME NOT NULL,

START_HOUR_DINNER TIME NOT NULL,

END_HOUR_DINNER TIME NOT NULL,

PRIMARY KEY (ID_RESTAURANT, DAY_OF_THE_WEEK),

CONSTRAINT RANGE_CHECK CHECK (START_HOUR_LUNCH < END_HOUR_LUNCH)

);

CREATE TABLE CUISINES (

ID INTEGER NOT NULL,

NAME VARCHAR(25) NOT NULL,

PRIMARY KEY (ID)

);

CREATE TABLE RESTAURANT_CUISINE (

ID_RESTAURANT INTEGER NOT NULL,

ID_CUISINE INTEGER NOT NULL,

PRIMARY KEY (ID_RESTAURANT, ID_CUISINE),

FOREIGN KEY (ID_RESTAURANT) REFERENCES RESTAURANTS (ID),

FOREIGN KEY (ID_CUISINE) REFERENCES CUISINES (ID)

);

CREATE TABLE REVIEWS (

ID INTEGER NOT NULL,

TITLE VARCHAR(31) NOT NULL,

GLOBAL_VALUE INTEGER NOT NULL CONSTRAINT REVIEW_GLOBAL_VALUE_CHECK CHECK

(GLOBAL_VALUE >= 1

AND GLOBAL_VALUE <= 5),

DESCRIPTION VARCHAR(32000),

DATE_CREATION TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

ID_RESTAURANT INTEGER NOT NULL,

ID_CREATOR INTEGER NOT NULL,

ID_PHOTO INTEGER,

VALIDATED BOOLEAN DEFAULT 0,

LIKES INTEGER,

PRIMARY KEY (ID),

FOREIGN KEY (ID_RESTAURANT) REFERENCES RESTAURANTS (ID),

FOREIGN KEY (ID_CREATOR) REFERENCES USERS (ID),

FOREIGN KEY (ID_PHOTO) REFERENCES PHOTOS (ID)

);

CREATE TABLE REPLIES (

ID INTEGER NOT NULL ,

DESCRIPTION VARCHAR(32000) NOT NULL,

DATE_CREATION TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

ID_REVIEW INTEGER NOT NULL,

PRIMARY KEY (ID),

FOREIGN KEY (ID_REVIEW) REFERENCES REVIEWS (ID)

);

INSERT INTO USERS(ID, FIRSTNAME, LASTNAME, USER_TYPE, USERNAME, PASSWORD)
VALUES (1,'Gianmaria', 'Moro', 'M', 'gianmaria.moro@studenti.unitn.it', 'ciao1'),
(2,'Leonardo', 'Cristini', 'M', 'leonardo.cristini@studenti.unitn.it', 'ciao2'),
(3,'Mario', 'Rossi', 'U', 'mario.rossi@hotmail.it', 'ciao3'),
(4,'Luca', 'Panarozzolo', 'R', 'pizzanapoli@hotmail.it', 'ciao4'),
(5,'Wu', 'Tang', 'R', 'cineseparty@hotmail.it', 'ciao5');

INSERT INTO CUISINES(ID, NAME)
VALUES(1 ,'Italiana'),
(2,'Asiatica'),
(3,'Nord Americana'),
(4,'Africana'),
(5,'Caraibica'),
(6,'Sud Americana'),
(7,'Nord Europea'),
(8,'Mediterranea'),
(9,'Medio Orientale'),
(10,'Vegana'),
(11,'Fast Food'),
(12,'Pizzeria');

INSERT INTO COORDINATES
VALUES(1, 46.06941967, 11.12015963, 'Via Roma 3'),
(2, 46.06657618, 11.11823916, 'Via Giuseppe Verdi 10'),
(3, 46.06483428, 11.12334609, 'Via S.Croce 8');

INSERT INTO RESTAURANTS
VALUES(1, 'Bella Napoli', 'Viale Verona', '5', 'Trento', 'Pizza napoletana di qualità con cottura a legna', 'www.pizzanapoli.it',4,2,4,4),
(2, 'Cinese Party', 'Corso 3 Novembre', '23', 'Trento', 'Cucina cinese cucinata da un vero chef cinese qualificato alla scuola più difficile di Pechino', 'www.cineseparty.com',3,2,5,5);

INSERT INTO OPENING_HOURS_RESTAURANTS
VALUES(1, 6, '9:00:00', '14:30:00','17:00:00', '00:30:00'),
(1, 7, '10:00:00', '15:00:00', '18:00:00', '22:30:00'),
(2, 1, '7:00:00', '13:30:00', '17:00:00', '23:30:00'),
(2, 2, '10:00:00', '14:30:00','16:30:00', '23:30:00');

INSERT INTO RESTAURANT_CUISINE
VALUES(1,1),
(2,3);


INSERT INTO REPLIES
VALUES(1, 'LA TUA PIZZA FA CAGARISSIMO, NON CAGARE', '2016-05-23 21:15:25',1,4,'2016-05-23 21:35:45',1);

INSERT INTO RESTAURANT_COORDINATE
VALUES(1,1),
(2,2);
